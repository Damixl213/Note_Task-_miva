<!-- Base template - navigation, chatbot, and layout structure -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- CSS frameworks and icons -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css')}}"/>
  
  <title>{% block title %} {% endblock %}</title>

  <style>
    body { background: #f8f9fa; }
    .todo-card { background: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05); }
    .task-completed { text-decoration: line-through; color: gray; }
  </style>
</head>
<body>
  <!-- Navigation bar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="/">NoteApp</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ml-auto">
          <!-- Dynamic navigation based on login status -->
          {% if user.is_authenticated %}
            <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
            <li class="nav-item"><a class="nav-link" href="/dashboard">Dashboard</a></li>
            <li class="nav-item"><a class="nav-link" href="/logout">Logout</a></li>
          {% else %}
            <li class="nav-item"><a class="nav-link" href="/login">Login</a></li>
            <li class="nav-item"><a class="nav-link" href="/sign-up">Sign Up</a></li>
          {% endif %}
        </ul>
      </div>
    </div>
  </nav> 
  
  <!-- Flash messages display -->
  {% with messages = get_flashed_messages(with_categories=true) %}
   {% if messages %}
     {% for category, message in messages %}
     {% if category == 'error' %}
       <div class="alert alert-danger alter-dismissable fade show" role="alert">
        {{ message }}
        <button type="button" class="close" data-dismiss="alert"><span>&times;</span></button>
       </div>
     {% else %}
       <div class="alert alert-success alter-dismissable fade show" role="alert">
        {{ message }}
        <button type="button" class="close" data-dismiss="alert"><span>&times;</span></button>
       </div>
     {% endif %}
     {% endfor %}
   {% endif %}
  {% endwith %}
  
  <!-- Main content area -->
  <div class="container-fluid px-2 px-md-4">
   {% block content %}{% endblock %}  
  </div>

  <!-- AI Chatbot Widget -->
  <div id="chatbot-fab" style="position:fixed;bottom:30px;right:30px;z-index:9999;cursor:pointer;">
    <div style="background:linear-gradient(135deg,#007bff,#00c6ff);width:60px;height:60px;border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 16px rgba(0,0,0,0.18);animation: chatbot-fab-pop 0.6s;">
      <i class="fa fa-comments" style="color:#fff;font-size:2rem;"></i>
    </div>
  </div>
  
  <!-- Chatbot interface -->
  <div id="chatbot-widget" style="position:fixed;bottom:100px;right:40px;z-index:9999;display:none;min-width:320px;max-width:95vw;">
    <div id="chatbot-header" style="background:linear-gradient(135deg,#007bff,#00c6ff);color:#fff;padding:14px 18px;border-radius:16px 16px 0 0;display:flex;align-items:center;justify-content:space-between;">
      <span style="font-weight:600;"><i class="fa fa-robot mr-2"></i>Study Bro</span>
      <span id="chatbot-close" style="font-size:1.5rem;cursor:pointer;">&times;</span>
    </div>
    <div id="chatbot-body" style="background:#fff;width:340px;height:400px;overflow-y:auto;padding:12px 10px 0 10px;border:1px solid #007bff;display:flex;flex-direction:column;border-radius:0 0 16px 16px;">
      <div id="chatbot-messages" style="flex:1;overflow-y:auto;"></div>
      <form id="chatbot-form" style="margin-top:8px;display:flex;gap:8px;">
        <input type="text" id="chatbot-input" class="form-control" placeholder="Ask meaning..." autocomplete="off" style="flex:1;">
        <button type="submit" class="btn btn-primary">Send</button>
      </form>
    </div>
  </div>

  <style>
    @keyframes chatbot-fab-pop {
      0% { transform: scale(0.5); opacity: 0; }
      80% { transform: scale(1.1); opacity: 1; }
      100% { transform: scale(1); }
    }
    @keyframes chatbot-slide-in {
      0% { transform: translateY(40px) scale(0.95); opacity: 0; }
      100% { transform: translateY(0) scale(1); opacity: 1; }
    }
    @keyframes chatbot-slide-out {
      0% { transform: translateY(0) scale(1); opacity: 1; }
      100% { transform: translateY(40px) scale(0.95); opacity: 0; }
    }
    #chatbot-widget {
      transition: box-shadow 0.2s;
    }
    #chatbot-fab:hover {
      box-shadow: 0 8px 32px rgba(0,0,0,0.28);
    }
    .chatbot-user { text-align:right; margin:5px 0; }
    .chatbot-bot { text-align:left; margin:5px 0; color:#343a40; }
    .chatbot-msg {
      display:inline-block;
      padding:10px 16px;
      border-radius:18px;
      max-width:80%;
      font-size:1rem;
      box-shadow:0 2px 8px rgba(0,0,0,0.06);
      margin-bottom:2px;
      animation: chatbot-msg-fadein 0.3s;
    }
    .chatbot-user .chatbot-msg { background:linear-gradient(135deg,#007bff,#00c6ff); color:#fff; }
    .chatbot-bot .chatbot-msg { background:#f1f1f1; }
    @keyframes chatbot-msg-fadein {
      from { opacity:0; transform:translateY(10px);}
      to { opacity:1; transform:translateY(0);}
    }
    #chatbot-body::-webkit-scrollbar, #chatbot-messages::-webkit-scrollbar {
      width: 6px;
      background: #eee;
    }
    #chatbot-body::-webkit-scrollbar-thumb, #chatbot-messages::-webkit-scrollbar-thumb {
      background: #b3e0ff;
      border-radius: 3px;
    }
  </style>
  <script>
    // Chatbot functionality
    document.addEventListener('DOMContentLoaded', function() {
      const fab = document.getElementById('chatbot-fab');
      const widget = document.getElementById('chatbot-widget');
      const close = document.getElementById('chatbot-close');
      const form = document.getElementById('chatbot-form');
      const input = document.getElementById('chatbot-input');
      const messages = document.getElementById('chatbot-messages');

      // Open/close chatbot
      fab.onclick = () => { widget.style.display = 'block'; fab.style.display = 'none'; };
      close.onclick = () => { widget.style.display = 'none'; fab.style.display = 'block'; };

      // Handle chat messages
      form.onsubmit = async function(e) {
        e.preventDefault();
        const text = input.value.trim();
        if (!text) return;
        
        // Add user message
        messages.innerHTML += `<div class="chatbot-user"><span class="chatbot-msg">${text}</span></div>`;
        input.value = '';
        
        // Send to API and get response
        try {
          const res = await fetch('/chat', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({message: text})
          });
          const data = await res.json();
          messages.innerHTML += `<div class="chatbot-bot"><span class="chatbot-msg">${data.answer || 'Sorry, no response.'}</span></div>`;
        } catch {
          messages.innerHTML += `<div class="chatbot-bot"><span class="chatbot-msg">You have to login or signup before using this feature.</span></div>`;
        }
        messages.scrollTop = messages.scrollHeight;
      };
    });
  </script>
  
  <!-- Bootstrap JavaScript -->
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
</body>
</html>